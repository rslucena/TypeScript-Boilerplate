bun test v1.3.9 (cf6cdbbb)

tests/domain/sso/routes.test.ts:
(pass) Domain - SSO Routes > Should redirect on /authorize with valid provider [146.99ms]
(pass) Domain - SSO Routes > Should fail on /authorize with invalid provider [20.00ms]
(pass) Domain - SSO Routes > Should process /callback and return normalized user on success [19.00ms]
(pass) Domain - SSO Routes > Should fail on /callback if missing code [20.00ms]

tests/integration/api/identity.test.ts:
(pass) Identity API Routes > GET /health > should return 200 [15.00ms]
(pass) Identity API Routes > GET /api/v1/identities/:id > should return 401 if unauthorized [8.00ms]
(pass) Identity API Routes > GET /api/v1/identities/:id > should return identity if authorized [11.00ms]
(pass) Identity API Routes > POST /api/v1/identities > should return 200/201 and create identity [10.00ms]
(pass) Identity API Routes > POST /api/v1/identities > should return 400 if validation fails [11.00ms]

tests/unit/builders/column.builders.spec.ts:
(pass) Column Builders > columnBuilder > should have all expected methods and properties
(pass) Column Builders > columnBuilder > should update values when methods are called
(pass) Column Builders > pgTableBuilder > should create a table object and call callback [1.00ms]
(pass) Column Builders > varcharBuilder > should create a varchar column
(pass) Column Builders > pgIndexBuilder > should return an empty object

tests/infrastructure/sso/oidc.test.ts:
(pass) Infrastructure - SSO Connect > Should generate authorization URL correctly for Google
(pass) Infrastructure - SSO Connect > Should generate authorization URL correctly for GitHub without nonce
54 | 		);
55 | 		spyOn(globalThis, "fetch").mockImplementation(mockFetch as any);
56 | 
57 | 		const result = await exchangeToken(providers.GOOGLE, "mock_auth_code");
58 | 
59 | 		expect(result.access_token).toBe("mock_access_token");
                                   ^
error: expect(received).toBe(expected)

Expected: "mock_access_token"
Received: "mock-access"

      at <anonymous> (/home/lucena/Área de trabalho/Codes/TypeScript-Boilerplate/backend/tests/infrastructure/sso/oidc.test.ts:59:31)
(fail) Infrastructure - SSO Connect > Should exchange token successfully using mock fetch
84 | 
85 | 		const result = await getNormalizedUser(providers.GITHUB, { access_token: "mock_git_token" });
86 | 
87 | 		expect(result.subject).toBe("12345");
88 | 		expect(result.name).toBe("Mock User");
89 | 		expect(result.email).toBe("mockuser@example.com");
                            ^
error: expect(received).toBe(expected)

Expected: "mockuser@example.com"
Received: "mock@google.com"

      at <anonymous> (/home/lucena/Área de trabalho/Codes/TypeScript-Boilerplate/backend/tests/infrastructure/sso/oidc.test.ts:89:24)
(fail) Infrastructure - SSO Connect > Should normalize GitHub user correctly

tests/unit/infra/pipes/safe-parse.spec.ts:
(pass) Transforms > safeParse > should parse valid JSON string correctly
(pass) Transforms > safeParse > should return undefined for invalid JSON string
(pass) Transforms > safeParse > should return undefined for non-JSON string

tests/unit/infra/pipes/credential.spec.ts:
(pass) Infrastructure: Pipes -> Credential > should return true for valid PASSWORD credential
(pass) Infrastructure: Pipes -> Credential > should return false for PASSWORD without secret
(pass) Infrastructure: Pipes -> Credential > should return false for PASSWORD with GOOGLE provider
(pass) Infrastructure: Pipes -> Credential > should return true for valid OIDC credential
(pass) Infrastructure: Pipes -> Credential > should return false for OIDC without subject
(pass) Infrastructure: Pipes -> Credential > should return false for OIDC with subject but invalid provider (LOCAL) [1.00ms]
(pass) Infrastructure: Pipes -> Credential > should return false for PASSWORD with subject (strictly forbidden if not required)

tests/unit/infra/server/webserver.spec.ts:
(pass) Webserver HTTP/2 Configuration > should configure HTTP/2 and HTTPS when APP_HTTP2 is true [11.00ms]
(pass) Webserver HTTP/2 Configuration > should NOT configure HTTP/2 when APP_HTTP2 is false [10.00ms]

tests/unit/infra/server/request.spec.ts:
(pass) Request Infrastructure > err class > should return unauthorized error
(pass) Request Infrastructure > err class > should return notFound error [1.00ms]
(pass) Request Infrastructure > err class > should return badRequest error
(pass) Request Infrastructure > err class > should return unprocessableEntity error
(pass) Request Infrastructure > err class > should return conflict error
(pass) Request Infrastructure > container class > should initialize with correct values
(pass) Request Infrastructure > container class > should update and return session
(pass) Request Infrastructure > container class > should update and return status
(pass) Request Infrastructure > container class > should update and return body
(pass) Request Infrastructure > container class > should update and return headers
(pass) Request Infrastructure > container class > should update and return query
(pass) Request Infrastructure > container class > should update and return params
(pass) Request Infrastructure > container class > should return session context if passed to session()
(pass) Request Infrastructure > container class > should return default language if not provided
(pass) Request Infrastructure > container class > should return default status if not provided
(pass) Request Infrastructure > convertRequestTypes > should skip documentation routes
(pass) Request Infrastructure > convertRequestTypes > should convert types correctly
(pass) Request Infrastructure > convertRequestTypes > should handle missing body/query/params
(pass) Request Infrastructure > execute wrapper > should execute noRestricted callback successfully [1.00ms]
(pass) Request Infrastructure > execute wrapper > should handle errors in callback and return 200 if error has no statusCode
(pass) Request Infrastructure > execute wrapper > should handle errors in callback with statusCode
(pass) Request Infrastructure > execute wrapper > should handle restricted routes and unauthorized access

tests/unit/infra/server/rate-limit.spec.ts:
(pass) Rate Limit Middleware > should allow request under limit
TEST: Mock incr value set to 101
(pass) Rate Limit Middleware > should block request over limit [1.00ms]
(pass) Rate Limit Middleware > should throw on redis error

tests/unit/infra/server/authentication.spec.ts:
(pass) Authentication Handler > should return false if no plugins succeed

tests/unit/infra/repositories/repository.spec.ts:
(pass) Repository Utilities > withPagination > should apply limit and offset correctly
(pass) Repository Utilities > manager logger > should use the defined logger and write messages [3.00ms]

tests/unit/infra/repositories/references.spec.ts:
(pass) Repository References > hash > should hash a string [49.00ms]
(pass) Repository References > hash > should compare correctly [133.00ms]
(pass) Repository References > hash > should hash an object [90.00ms]
(pass) Repository References > tag > should generate a simple tag
(pass) Repository References > tag > should generate a tag with conditions
(pass) Repository References > pgIndex > should generate index configurations
(pass) Repository References > identifier > should have correct fields [1.00ms]

tests/unit/infra/languages/translate.spec.ts:
(pass) Languages Infrastructure > Languages object > should have en, es, and pt-br languages
(pass) Languages Infrastructure > Languages object > should have keys in en dictionary [1.00ms]
(pass) Languages Infrastructure > translate function > should translate an existing key to english by default
(pass) Languages Infrastructure > translate function > should translate an existing key to pt-br
(pass) Languages Infrastructure > translate function > should fallback to english if language is unknown
(pass) Languages Infrastructure > translate function > should return the key if it does not exist in the dictionary
(pass) Languages Infrastructure > translate function > should return the key from english dictionary if dictionary for requested language exists but key does not, and key exists in english

tests/unit/infra/messages/actions.spec.ts:
(pass) Messaging Infrastructure > Resilience (Graceful Degradation) > should fallback to internal events when Redis is offline (pub)
(pass) Messaging Infrastructure > Resilience (Graceful Degradation) > should fallback to internal events when Redis is offline (sub)
(pass) Messaging Infrastructure > Resilience (Graceful Degradation) > should return PONG even if Redis is offline (ping) [1.00ms]
(pass) Messaging Infrastructure > Distributed (Redis Online) > should use Redis when online (pub)
(pass) Messaging Infrastructure > Distributed (Redis Online) > should use Redis when online (sub)

tests/unit/infra/cache/actions.spec.ts:
(pass) Cache Infrastructure > Text Actions > should set value correctly
(pass) Cache Infrastructure > Text Actions > should handle set error correctly
(pass) Cache Infrastructure > Text Actions > should set value with TTL [1.00ms]
(pass) Cache Infrastructure > Text Actions > should get value correctly
(pass) Cache Infrastructure > Text Actions > should delete value correctly
(pass) Cache Infrastructure > JSON Actions > should set json value correctly
(pass) Cache Infrastructure > JSON Actions > should handle json set error correctly
(pass) Cache Infrastructure > JSON Actions > should get json value correctly [1.00ms]
(pass) Cache Infrastructure > JSON Actions > should delete json value correctly
(pass) Cache Infrastructure > should ping correctly

tests/unit/domain/identity/entity.spec.ts:
(pass) Identity Entity > should be defined
(pass) Identity Entity > should have field 'name'
(pass) Identity Entity > should have field 'email'
(pass) Identity Entity > should have field 'lastName'

tests/unit/domain/identity/get-find-by-params.spec.ts:
(pass) Identity Domain Actions : getFindByParams > should return cached identities if available [1.00ms]
(pass) Identity Domain Actions : getFindByParams > should return identities from repository if not cached [1.00ms]
(pass) Identity Domain Actions : getFindByParams > should throw error if no identities found
(pass) Identity Domain Actions : getFindByParams > should throw error if validation fails

tests/unit/domain/identity/get-by-id.spec.ts:
(pass) Identity Domain Actions : getById > should return cached identity if available
(pass) Identity Domain Actions : getById > should return identity from repository if not cached
(pass) Identity Domain Actions : getById > should throw error if identity not found

tests/unit/domain/identity/post-new-entity.spec.ts:
(pass) Identity Domain Actions : postNewEntity > should create new identity and return it
(pass) Identity Domain Actions : postNewEntity > should throw 409 if conflict (duplicate email)
(pass) Identity Domain Actions : postNewEntity > should throw 400 if validation fails [1.00ms]

tests/unit/infra/authentication/strategies/jwt.spec.ts:
(pass) JWT Strategy > create > should create a valid JWT string [1.00ms]
(pass) JWT Strategy > create > should create a JWT with specific expiration
(pass) JWT Strategy > session > should return the decoded session for a valid token [1.00ms]
(pass) JWT Strategy > session > should throw 'Unauthorized' if authorization header is missing
(pass) JWT Strategy > session > should throw 'Unauthorized' for malformed token [1.00ms]
(pass) JWT Strategy > session > should throw 'Unauthorized' for invalid signature
(pass) JWT Strategy > session > should throw 'Unauthorized' if token is expired [1.00ms]
(pass) JWT Strategy > session > should throw 'Unauthorized' if header is invalid JSON

2 tests failed:
(fail) Infrastructure - SSO Connect > Should exchange token successfully using mock fetch
(fail) Infrastructure - SSO Connect > Should normalize GitHub user correctly
---------------------------------------------------|---------|---------|-------------------
File                                               | % Funcs | % Lines | Uncovered Line #s
---------------------------------------------------|---------|---------|-------------------
All files                                          |   80.43 |   91.92 |
 src/domain/credentials/constants.ts               |  100.00 |  100.00 | 
 src/domain/identity/actions/get-by-id.ts          |  100.00 |  100.00 | 
 src/domain/identity/actions/get-find-by-params.ts |  100.00 |  100.00 | 
 src/domain/identity/actions/get-health.ts         |  100.00 |  100.00 | 
 src/domain/identity/actions/post-new-entity.ts    |  100.00 |  100.00 | 
 src/domain/identity/routes.ts                     |  100.00 |  100.00 | 
 src/domain/identity/schema.ts                     |  100.00 |  100.00 | 
 src/domain/sso/actions/get-authorize.ts           |  100.00 |  100.00 | 
 src/domain/sso/actions/get-callback.ts            |  100.00 |  100.00 | 
 src/domain/sso/routes.ts                          |  100.00 |  100.00 | 
 src/domain/sso/schema.ts                          |  100.00 |  100.00 | 
 src/infrastructure/authentication/jwt.ts          |   80.00 |   96.15 | 85-86
 src/infrastructure/cache/actions.ts               |   70.27 |  100.00 | 
 src/infrastructure/cache/connection.ts            |    0.00 |  100.00 | 
 src/infrastructure/languages/translate.ts         |  100.00 |  100.00 | 
 src/infrastructure/logs/handler.ts                |   42.86 |  100.00 | 
 src/infrastructure/messages/actions.ts            |   88.89 |   88.24 | 14-15
 src/infrastructure/pipes/credential.ts            |  100.00 |  100.00 | 
 src/infrastructure/pipes/crypto.ts                |   75.00 |   55.32 | 26-36,40-49
 src/infrastructure/pipes/safe-parse.ts            |  100.00 |  100.00 | 
 src/infrastructure/repositories/connection.ts     |  100.00 |  100.00 | 
 src/infrastructure/repositories/references.ts     |  100.00 |  100.00 | 
 src/infrastructure/repositories/repository.ts     |    0.00 |   94.74 | 
 src/infrastructure/server/authentication.ts       |    0.00 |   13.04 | 5-24
 src/infrastructure/server/interface.ts            |   93.33 |  100.00 | 
 src/infrastructure/server/rate-limit.ts           |  100.00 |  100.00 | 
 src/infrastructure/server/request.ts              |  100.00 |  100.00 | 
 src/infrastructure/server/webserver.ts            |   23.08 |   84.15 | 55-56,63-65,78-85
 src/infrastructure/settings/cors.ts               |   50.00 |   87.50 | 12-13
 src/infrastructure/settings/environment.ts        |   75.00 |   80.77 | 44-45,47-51,53-55
 src/infrastructure/settings/helmet.ts             |  100.00 |  100.00 | 
 src/infrastructure/settings/plugins.ts            |  100.00 |  100.00 | 
 src/infrastructure/settings/swagger.ts            |  100.00 |  100.00 | 
 src/infrastructure/sso/oidc.ts                    |   16.67 |   17.14 | 10,27-52,63-70,80-110,114-146,150-166
 src/infrastructure/sso/providers.ts               |  100.00 |  100.00 | 
---------------------------------------------------|---------|---------|-------------------

 107 pass
 2 fail
 201 expect() calls
Ran 109 tests across 20 files. [1095.00ms]
